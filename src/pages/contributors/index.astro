---
import ExtendedLayout from "@layouts/ExtendedLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import ContributorCard from "@components/contributors/ContributorCard.astro";

const contributors = await getCollection("contributors");
const activeContributors = contributors.filter(
  (contributor) => contributor.data.isActive
);
const sortedContributors = activeContributors.sort(
  (a: CollectionEntry<"contributors">, b: CollectionEntry<"contributors">) => {
    const aScore =
      a.data.socialProof.githubStars + a.data.socialProof.communityReputation;
    const bScore =
      b.data.socialProof.githubStars + b.data.socialProof.communityReputation;
    return bScore - aScore;
  }
);

// Group contributors by role
const contributorsByRole = sortedContributors.reduce(
  (acc, contributor: CollectionEntry<"contributors">) => {
    const role = contributor.data.role;
    if (!acc[role]) {
      acc[role] = [];
    }
    acc[role].push(contributor);
    return acc;
  },
  {} as Record<string, typeof sortedContributors>
);

// Calculate community stats
const totalContributions = contributors.reduce(
  (sum, contributor: CollectionEntry<"contributors">) => {
    return (
      sum +
      contributor.data.contributions.blogPosts +
      contributor.data.contributions.openSourceProjects.reduce(
        (projectSum: any, project: { contributions: any }) =>
          projectSum + (project.contributions || 0),
        0
      ) +
      contributor.data.contributions.koneksiProjects.length +
      contributor.data.contributions.communityContributions.length
    );
  },
  0
);

const totalOpenSourceProjects = contributors.reduce(
  (sum, contributor: CollectionEntry<"contributors">) => {
    return sum + contributor.data.contributions.openSourceProjects.length;
  },
  0
);

const totalKoneksiProjects = contributors.reduce(
  (sum, contributor: CollectionEntry<"contributors">) => {
    return sum + contributor.data.contributions.koneksiProjects.length;
  },
  0
);
---

<ExtendedLayout
  title="Kontributor Koneksi - Komunitas Pengembang Indonesia"
  description="Temukan kontributor-kontributor terbaik di ekosistem teknologi Indonesia. Dari open source hingga project Koneksi, mari bersama membangun komunitas yang kompetitif dan kolaboratif."
>
  <!-- Hero Section -->
  <section
    class="hero-section from-primary-50 to-secondary-50 bg-linear-to-br py-20 md:py-32"
  >
    <div class="container">
      <div class="mx-auto max-w-4xl text-center">
        <h1 class="mb-6 text-4xl font-bold lg:text-6xl">
          <span class="text-gradient">Kontributor</span> Koneksi
        </h1>
        <p class="mb-8 text-xl text-neutral-600">
          Komunitas pengembang Indonesia yang kompetitif, kolaboratif, dan
          sehat. Dari open source hingga project Koneksi, mari bersama membangun
          ekosistem teknologi yang lebih baik.
        </p>

        <!-- Community Stats -->
        <div class="mb-8 grid grid-cols-2 gap-4 md:grid-cols-4">
          <div class="stat-card">
            <div class="stat-number">{contributors.length}</div>
            <div class="stat-label">Kontributor Aktif</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">{totalContributions}</div>
            <div class="stat-label">Total Kontribusi</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">{totalOpenSourceProjects}</div>
            <div class="stat-label">Project Open Source</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">{totalKoneksiProjects}</div>
            <div class="stat-label">Project Koneksi</div>
          </div>
        </div>

        <!-- CTA Buttons -->
        <div class="flex flex-col justify-center gap-4 sm:flex-row">
          <a href="#contributors" class="btn-primary"> Lihat Kontributor </a>
          <a href="/contributors/join" class="btn-secondary">
            Bergabung sebagai Kontributor
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Contributors -->
  <section class="bg-white py-16 md:py-24">
    <div class="container">
      <div class="mb-12 text-center">
        <h2 class="mb-4 text-3xl font-bold">Kontributor Unggulan</h2>
        <p class="text-neutral-600">
          Kontributor dengan dampak terbesar di komunitas
        </p>
      </div>

      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {
          sortedContributors
            .slice(0, 6)
            .map((contributor, index) => (
              <ContributorCard
                contributor={contributor}
                variant={index < 3 ? "featured" : "default"}
                showDetails={true}
              />
            ))
        }
      </div>
    </div>
  </section>
  <!-- Join Community CTA -->
  <section
    class="from-primary-500 to-secondary-500 bg-linear-to-br py-16 text-white md:py-20"
  >
    <div class="container">
      <div class="mx-auto max-w-3xl text-center">
        <h2 class="mb-4 text-3xl font-bold">Bergabung dengan Komunitas</h2>
        <p class="mb-8 text-xl opacity-90">
          Apakah Anda ingin berkontribusi pada project open source Indonesia
          atau project Koneksi? Mari bergabung dan bersama-sama membangun
          ekosistem teknologi yang lebih baik.
        </p>

        <div class="flex flex-col justify-center gap-4 sm:flex-row">
          <a href="/contributors/join" class="btn-white">
            Daftar sebagai Kontributor
          </a>
          <a href="/projects" class="btn-outline-white">
            Lihat Project Tersedia
          </a>
        </div>
      </div>
    </div>
  </section>
  <!-- Contributors by Role -->
  <section id="contributors" class="bg-neutral-50 py-16 md:py-24">
    <div class="container">
      <div class="mb-12 text-center">
        <h2 class="mb-4 text-3xl font-bold">Kontributor Berdasarkan Peran</h2>
        <p class="text-neutral-600">
          Temukan kontributor berdasarkan keahlian dan peran mereka
        </p>
      </div>

      {
        Object.entries(contributorsByRole).map(([role, roleContributors]) => (
          <div class="mb-12">
            <div class="mb-6 flex items-center gap-3">
              <h3 class="text-2xl font-bold text-neutral-800">
                {role === "developer" && "üë®‚Äçüíª Developer"}
                {role === "designer" && "üé® Designer"}
                {role === "writer" && "‚úçÔ∏è Writer"}
                {role === "researcher" && "üî¨ Researcher"}
                {role === "mentor" && "üéì Mentor"}
                {role === "community-leader" && "üëë Community Leader"}
                {role === "open-source-contributor" &&
                  "üåê Open Source Contributor"}
              </h3>
              <span class="bg-primary-100 text-primary-700 rounded-full px-3 py-1 text-sm font-medium">
                {roleContributors.length} kontributor
              </span>
              {role === "writer" && (
                <a
                  href="/contributors/writers"
                  class="bg-primary-600 hover:bg-primary-700 rounded-full px-3 py-1 text-sm font-medium text-white transition-colors"
                >
                  Lihat Semua Writers
                </a>
              )}
            </div>

            <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              {roleContributors.map((contributor) => (
                <ContributorCard
                  contributor={contributor}
                  variant="compact"
                  showDetails={false}
                />
              ))}
            </div>
          </div>
        ))
      }
    </div>
  </section>

  <!-- Open Source Projects Showcase -->
  <section class="bg-white py-16 md:py-20">
    <div class="container">
      <div class="mb-12 text-center">
        <h2 class="mb-4 text-3xl font-bold">Project Open Source Indonesia</h2>
        <p class="text-neutral-600">
          Project-project yang dikontribusi oleh komunitas Koneksi
        </p>
      </div>

      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        <!-- SLiMS -->
        <div class="project-card">
          <div class="project-header">
            <div class="project-icon">üìö</div>
            <h3 class="project-title">SLiMS</h3>
            <p class="project-description">
              Sistem Informasi Perpustakaan Berbasis Web
            </p>
          </div>
          <div class="project-stats">
            <div class="stat">
              <span class="stat-number">500+</span>
              <span class="stat-label">Instalasi</span>
            </div>
            <div class="stat">
              <span class="stat-number">50+</span>
              <span class="stat-label">Kontributor</span>
            </div>
          </div>
          <div class="project-links">
            <a
              href="https://github.com/slims/slims9_bulian"
              target="_blank"
              class="project-link"
            >
              GitHub
            </a>
            <a href="https://slims.web.id" target="_blank" class="project-link">
              Website
            </a>
          </div>
        </div>

        <!-- DracOS -->
        <div class="project-card">
          <div class="project-header">
            <div class="project-icon">üêâ</div>
            <h3 class="project-title">DracOS</h3>
            <p class="project-description">
              Linux Distribution untuk Security Testing
            </p>
          </div>
          <div class="project-stats">
            <div class="stat">
              <span class="stat-number">1000+</span>
              <span class="stat-label">Downloads</span>
            </div>
            <div class="stat">
              <span class="stat-number">20+</span>
              <span class="stat-label">Kontributor</span>
            </div>
          </div>
          <div class="project-links">
            <a
              href="https://github.com/dracos-linux"
              target="_blank"
              class="project-link"
            >
              GitHub
            </a>
            <a
              href="https://dracos-linux.org"
              target="_blank"
              class="project-link"
            >
              Website
            </a>
          </div>
        </div>

        <!-- OpenSID -->
        <div class="project-card">
          <div class="project-header">
            <div class="project-icon">üèòÔ∏è</div>
            <h3 class="project-title">OpenSID</h3>
            <p class="project-description">Sistem Informasi Desa Terbuka</p>
          </div>
          <div class="project-stats">
            <div class="stat">
              <span class="stat-number">10K+</span>
              <span class="stat-label">Desa</span>
            </div>
            <div class="stat">
              <span class="stat-number">100+</span>
              <span class="stat-label">Kontributor</span>
            </div>
          </div>
          <div class="project-links">
            <a
              href="https://github.com/OpenSID/OpenSID"
              target="_blank"
              class="project-link"
            >
              GitHub
            </a>
            <a
              href="https://opensid.my.id"
              target="_blank"
              class="project-link"
            >
              Website
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</ExtendedLayout>

<style>
  @reference "@/styles/global.css";

  .text-gradient {
    background: linear-gradient(135deg, #3b82f6, #14b8a6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-section {
    @apply relative overflow-hidden;
  }

  .hero-section::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
  }

  .hero-section .container {
    @apply relative z-10;
  }

  .stat-card {
    @apply rounded-xl border border-neutral-100 bg-white p-4 text-center shadow-sm;
  }

  .stat-number {
    @apply text-primary-600 text-2xl font-bold;
  }

  .stat-label {
    @apply text-sm text-neutral-600;
  }

  .btn-primary {
    @apply bg-primary-500 hover:bg-primary-600 inline-flex items-center gap-2 rounded-lg px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 hover:-translate-y-0.5 hover:shadow-xl;
  }

  .btn-secondary {
    @apply text-primary-600 border-primary-200 hover:bg-primary-50 inline-flex items-center gap-2 rounded-lg border bg-white px-6 py-3 font-semibold shadow-lg transition-all duration-200 hover:-translate-y-0.5 hover:shadow-xl;
  }

  .btn-white {
    @apply text-primary-600 inline-flex items-center gap-2 rounded-lg bg-white px-6 py-3 font-semibold shadow-lg transition-all duration-200 hover:-translate-y-0.5 hover:bg-neutral-50 hover:shadow-xl;
  }

  .btn-outline-white {
    @apply hover:text-primary-600 inline-flex items-center gap-2 rounded-lg border border-white bg-transparent px-6 py-3 font-semibold text-white shadow-lg transition-all duration-200 hover:-translate-y-0.5 hover:bg-white hover:shadow-xl;
  }

  .project-card {
    @apply rounded-2xl border border-neutral-100 bg-white p-6 shadow-lg transition-all duration-300 hover:-translate-y-1 hover:shadow-xl;
  }

  .project-header {
    @apply mb-4;
  }

  .project-icon {
    @apply mb-2 text-3xl;
  }

  .project-title {
    @apply mb-2 text-xl font-bold text-neutral-800;
  }

  .project-description {
    @apply text-sm text-neutral-600;
  }

  .project-stats {
    @apply mb-4 flex gap-4;
  }

  .project-stats .stat {
    @apply text-center;
  }

  .project-stats .stat-number {
    @apply text-primary-600 block text-lg font-bold;
  }

  .project-stats .stat-label {
    @apply block text-xs text-neutral-500;
  }

  .project-links {
    @apply flex gap-2;
  }

  .project-link {
    @apply bg-primary-100 text-primary-700 hover:bg-primary-200 flex-1 rounded-lg px-3 py-2 text-center text-sm font-medium transition-colors;
  }

  /* Dark mode styles */
  .dark .hero-section {
    @apply from-primary-900 to-secondary-900;
  }

  .dark .hero-section h1 {
    @apply text-neutral-100;
  }

  .dark .hero-section p {
    @apply text-neutral-300;
  }

  .dark .stat-card {
    @apply border-neutral-700 bg-neutral-800;
  }

  .dark .project-card {
    @apply border-neutral-700 bg-neutral-800;
  }

  .dark .project-title {
    @apply text-neutral-100;
  }

  .dark .project-description {
    @apply text-neutral-400;
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .hero-section h1 {
      @apply text-3xl;
    }

    .stat-card {
      @apply p-3;
    }

    .project-card {
      @apply p-4;
    }
  }
</style>
