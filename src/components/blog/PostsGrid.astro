---
// Posts Grid Component
import Card from '@components/ui/Card.astro';
import CategoryFilter from '@components/blog/CategoryFilter.astro';
import TagCloud from '@components/blog/TagCloud.astro';
import PopularPosts from '@components/blog/PopularPosts.astro';
import type { CollectionEntry } from 'astro:content';

export interface Props {
  class?: string;
  posts: CollectionEntry<'blog'>[];
  showFilters?: boolean;
  showSidebar?: boolean;
}

const { 
  class: className,
  posts,
  showFilters = true,
  showSidebar = true
} = Astro.props;

const hasPosts = posts.length > 0;
---

<section class={`posts-grid section bg-neutral-50 ${className || ''}`}>
  <div class="container">
    <h2 class="text-3xl font-bold mb-8 text-center">Semua Artikel</h2>
    
    {showFilters && (
      <div class="mb-8">
        <CategoryFilter />
      </div>
    )}
    
    {showFilters && (
      <div class="mb-8">
        <TagCloud />
      </div>
    )}
    
    {showSidebar && (
      <div class="mb-8">
        <PopularPosts />
      </div>
    )}
    
    {showSidebar && (
      <div class="mb-8">
        <!-- AuthorProfiles removed - now available at /contributors/writers -->
      </div>
    )}
    
    {!hasPosts ? (
      <div class="text-center py-16">
        <div class="text-6xl mb-4">üìù</div>
        <h3 class="text-2xl font-bold mb-4">Artikel Segera Hadir</h3>
        <p class="text-neutral-600 mb-8">
          Tim KonXC sedang menyiapkan artikel-artikel berkualitas untuk Anda.
          Daftar newsletter untuk mendapatkan notifikasi artikel terbaru.
        </p>
        <a href="#newsletter" class="btn-primary">
          Daftar Newsletter
        </a>
      </div>
    ) : (
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {posts.map((post) => {
          const publishDate = post.data.publishDate.toLocaleDateString('id-ID', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });
          
          return (
            <Card class="group post-card">
              <div class="mb-4">
                <div class="text-xs font-semibold text-primary-600 mb-2 uppercase tracking-wide">
                  {post.data.category}
                </div>
                <h3 class="text-xl font-bold mb-3 group-hover:text-primary-600 transition-colors line-clamp-2">
                  {post.data.title}
                </h3>
                <p class="text-neutral-600 text-sm mb-4 line-clamp-3">
                  {post.data.description}
                </p>
              </div>
              
              <div class="flex items-center justify-between text-xs text-neutral-500 mb-4">
                <div class="flex items-center gap-2">
                  <span class="flex h-6 w-6 items-center justify-center rounded-full bg-primary-100 font-semibold text-primary-600 text-xs">
                    {post.data.author.charAt(0)}
                  </span>
                  <span>By {post.data.author}</span>
                </div>
                <span>{publishDate}</span>
              </div>
              
              <div class="flex items-center justify-between">
                <div class="flex flex-wrap gap-1">
                  {post.data.tags.slice(0, 2).map((tag) => (
                    <span class="px-2 py-1 bg-neutral-100 text-neutral-600 text-xs rounded">
                      {tag}
                    </span>
                  ))}
                </div>
                <a href={`/blog/${post.slug}`} class="text-primary-600 font-semibold text-sm hover:text-primary-700 transition-colors">
                  Baca ‚Üí
                </a>
              </div>
              
              {post.data.featured && (
                <div class="absolute top-4 right-4">
                  <span class="px-2 py-1 bg-yellow-100 text-yellow-700 text-xs rounded-full font-medium">
                    ‚≠ê Featured
                  </span>
                </div>
              )}
            </Card>
          );
        })}
      </div>
    )}
  </div>
</section>

<style>
  @reference "@/styles/global.css";
  .posts-grid {
    @apply relative;
  }
  
  .post-card {
    @apply relative transition-all duration-300 hover:transform hover:-translate-y-1 hover:shadow-lg;
  }
  
  .post-card:hover {
    @apply shadow-xl;
  }
  
  .btn-primary {
    @apply inline-flex items-center gap-2 px-6 py-3 bg-primary-500 text-white rounded-lg font-semibold hover:bg-primary-600 transition-all duration-200 shadow-lg hover:shadow-xl;
  }
  
  .btn-primary:hover {
    @apply transform -translate-y-0.5;
  }
  
  /* Dark mode styles */
  .dark .posts-grid h2 {
    @apply text-neutral-100;
  }
  
  .dark .posts-grid h3 {
    @apply text-neutral-200;
  }
  
  .dark .posts-grid p {
    @apply text-neutral-400;
  }
  
  .dark .posts-grid .text-neutral-500 {
    @apply text-neutral-400;
  }
  
  .dark .posts-grid .text-neutral-600 {
    @apply text-neutral-300;
  }
  
  .dark .posts-grid .bg-neutral-100 {
    @apply bg-neutral-700;
  }
  
  .dark .posts-grid .text-neutral-600 {
    @apply text-neutral-300;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .posts-grid .grid {
      @apply grid-cols-1 gap-6;
    }
    
    .post-card {
      @apply p-4;
    }
  }
</style>
